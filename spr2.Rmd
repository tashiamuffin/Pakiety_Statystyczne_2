---
title: "Sprawozdanie 2"
author: "Alicja Myśliwiec, Natalia Lach"
date: "`r Sys.Date()`"
fontsize: 12pt
output:
  pdf_document:
        toc: true
        toc_depth: 3
        number_sections: true
        fig_caption: true
        
header-includes:
    - \usepackage{polski}
    - \usepackage[utf8]{inputenc}
    - \usepackage{graphicx}
    - \usepackage{amsmath}
    - \usepackage{multirow}
    - \usepackage{float}
    - \usepackage{enumitem}
    - \usepackage{mathtools}
    - \usepackage{hyperref}
    - \usepackage{url}
    - \mathtoolsset{showonlyrefs}
    - \usepackage{caption}
    - \usepackage{geometry}
    - \newgeometry{tmargin=1.5cm, bmargin=1.5cm, lmargin=1.5cm, rmargin=1.5cm}
    - \renewcommand*{\figurename}{Rys.}
    - \renewcommand*{\tablename}{Tab.}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r, include=FALSE}
## MODUŁY
require(gridExtra)
library('dplyr')
library(ggplot2)
#options(repr.plot.width =13, repr.plot.height =6)
```
\newpage


# Wstęp
```{=LATEX}
W niniejszej pracy zostanie przeprowadzaone testowanie hipotez dla trzech różnych testów. Analizie zostaną poddane moce owych testów, czyli prawdopodobieństwa odrzucenia fałszywej hipotezy zerowej na rzecz przyjęcia prawdziwej hipotezy alternatywnej. Testowana będzię hipoteza dwustronna, tj.    $H_0$: $\mu_1=\mu_2$ przeciwko $H_1$: $\mu_1\neq\mu_2$.

 XDD Odpowiednio postawione pytania badawcze oraz uzyskane odpowiedzi, pozwoliły dokonać interpretacji wyników, z których wysunięte zostały wnioski na temat czynników wpływających na popularność owego gatunku książek. Wszelkie operacje oraz wizualizacje przeprowadzono w języku R.
```
# Zagadnienia teoretyczne
przydatne definicje i twierdzenia
```{=LATEX}
$p$-wartość, czyli wartość prawdopodobieństwa zdarzenia, że w uzyska się podobną wartość w drugim teście jaką sie otrzymało w pierwszym. Jest to najmniejszy poziom istotności $\alpha$, przy którym zaobserwowane wartości statystyki testowej prowadzą do odrzucenia hipotezy zerowej.
```

## test t-Studenta i test t-Welcha
```{=LATEX}
Test t-Studenta jest jednym z testów, który może poróWnać ze sobą średnie z dwóch niezależnych od siebie prób z rozkładu normalnego. Sprawdza on, czy różnice pomiędzy tymi wartościami są istotne statystycznie. Aby mówić o oryginalnym teście t-Studenta, musimy mieć doczynienia z próbami o równych wariancjach. Powinna zostać również spełniona równoliczność prób, jednak test ten jest odporny na pominięcie tego założenia. Natomiast jeśli taka sama liczność grup zostanie zachowana, test staje się odporny na niespełnienia założenia o równych wariancjach.\footnote{\url{https://en.wikipedia.org/wiki/Student's_t-test}}

Możemy również powiedzieć o uogólnionej postaci owego testu, mianowicie o teście t-Welcha. Zostając przy założeniu normalności rozkładóW porównywanych prób, nie są wymagane w tym przypadku równe wariancje.
```

## test sum rang Wilcoxona
```{=LATEX}
Jakiś tam test opis. Test Wilcoxona jest nieparametrycznym odpowiednikiem t testóW. Nie wymaga on założeń co do rozkładów testowanych prób.W przypadku szczególnym, tj. dwóch prób z rozkładów symetrycznych wraz z parametrem przesunięcia, będzie on dotyczył średnich.
```
## Moc testu
definicja i algorytm generowania
```{=LATEX}
Moc testu jest dopełnieniem do jedności wartości prawdopodobieństwa popełnienia błędu II rodzaju, czyli moc określa prawdopodobieśtwo odrzucenia fałszywej hipotezy zerowej. 
```
## test jednostajnie najmocniejszy
```{=LATEX}
Mówimy, że test jest jednostajnie najmocniejszy, jeśli moc tego testu jest niemniejsza niż moc każdego innego rozważanego testu danych hipotez.
```
# Zadania

```{=LATEX}
Każde z zadań polega na sprawdzeniu podanych we wstępie hipotez na poziomie istotności $\alpha = 0.05$. Rozważane będą kolejno próby z różnych rozkładów i Zostaną one w każdym przypadku poddane trzem wyżej opisanym testom. Do analizy mocy ów testóW zostanie przeprowadzona symulacja Monte Carlo, która jednocześnie pozwoli nam odpowiedzieć na pytanie, czy któryś ze stosowanych testów jest wśrod reszty jednostajnie najmocniejszy. 
```

## Zadanie 1

```{=LATEX}
Rozważmy próbę $\left(X_1, \ldots, X_{100}\right)$ z rozkładu normalnego $\mathcal{N}(\mu_1, 2^2)$ oraz próbę $\left(Y_1, \ldots, Y_{200}\right)$ z rozkładu normalnego $\mathcal{N}(\mu_2, 2^2)$. Wykonaj wykres funcji mocy w zależności od $\mu_2-\mu_1$ na przedziale $(-2, 2)$ dla wszystkich trzech testów.
```

### Założenia  i cel zadania
```{=LATEX}

```

```{r}
d <- 1
m1 <- 0
m2 <- m1 + d
X <- rnorm(100, m1, 2)
Y <- rnorm(200, m2, 4)
d <- seq(-2,2,0.1)
N <- 1000

```

### rozwiązanie 
```{r, include=FALSE}
freedom <- function(s1,s2,n1,n2) {
    (s1/n1 + s2/n2)^2/((s1/n1)^2/(n1-1) + (s2/n2)^2/(n2-1))
}
```


```{r}
zad1 <- function(d, s1=2, s2=2, a = 0.05) {
    X <- rnorm(100, 0, s1)
    Y <- rnorm(200, d, s2)
    welch <- t.test(X, Y, alternative = "two.sided", var.equal = FALSE)$p.value < a
    welch2 <- abs(t.test(X, Y, alternative = "two.sided", var.equal = FALSE)$statistic) > qt(1-a/2, freedom(s1, s2,100,200))
    ttest <- t.test(X, Y, alternative = "two.sided", var.equal = TRUE)$p.value < a
    ttest2 <- abs(t.test(X, Y, alternative = "two.sided", var.equal = TRUE)$statistic) > qt(1-a/2, freedom(s1, s2,100,200))
    wilcox <- wilcox.test(X, Y, alternative = "two.sided")$p.value < a
    c(ttest, welch, wilcox, ttest2, welch2)
}

#v <-  sapply(d, zad1)
#for (i in seq(1,N-1,1)) {
#    v <- v + sapply(d, zad1)
#}
#mat <- v/N
```

```{r, include = FALSE}
#p <- ggplot() + geom_point(aes(d, mat[1,], color="t")) +
#geom_point(aes(d, mat[2,], color="t-welch")) + geom_point(aes(d, mat[3,], color="wilcoxon")) + 
#geom_line(aes(d, mat[1,], color="t")) +geom_line(aes(d, mat[2,], color="t-welch")) +
#geom_line(aes(d, mat[3,], color="wilcoxon"))+geom_line(aes(d, rep(0.05, length(d)), color="alpha = 0.05")) + labs(x="d", y ="moc") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))

#ggsave("1.jpg", p)
```


```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{1.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o równych wariancjach.}
\label{w1}
\end{center}
\end{figure}
```

PORÓWNANIE METOD - symulacja na podstawie pwartości vs wartości krytycznej - test t (powinno wyjść to samo)
```{r, include = FALSE}
#p <- ggplot() + geom_point(aes(d, mat[1,], color="p-value")) +
#geom_point(aes(d, mat[4,], color="critical value")) + geom_line(aes(d, mat[1,], color="p-value")) +
#  geom_line(aes(d, mat[4,], color="critical value")) + geom_line(aes(d, rep(0.05, length(d)), color="alpha = 0.05")) + labs(x="d", y ="moc") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))

#ggsave("11.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{11.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o równych wariancjach.}
\label{w11}
\end{center}
\end{figure}
```

PORÓWNANIE METOD - symulacja na podstawie pwartości vs wartości krytycznej - test welcha
```{r, include = FALSE}
#p <- ggplot() + geom_point(aes(d, mat[2,], color="p-value")) +
#geom_point(aes(d, mat[5,], color="critical value")) + 
##geom_line(aes(d, mat[2,], color="p-value")) + geom_line(aes(d, mat[5,], color="critical value")) + geom_line(aes(d, rep(0.05, length(d)), color="alpha = 0.05")) + labs(x="d", y ="moc") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))

#ggsave("12.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{12.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o równych wariancjach.}
\label{w12}
\end{center}
\end{figure}
```

dla wilcoxona nie umiem


ogólnie obie metody wyszły identyczne - używamy od teraz tylko jednej żeby nie marnować papieru 

```{r, include = FALSE}
#p <- ggplot() + geom_line(aes(d, (mat[1,]-mat[2,]), color="t-welch")) +
#geom_line(aes(d, (mat[2,] - mat[3,]), color="welch -wc")) + geom_line(aes(d, (mat[1,] - mat[3,]), color="t-wc")) + labs(x="d", y ="dpower") +
##theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))
#ggsave("111.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{111.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o równych wariancjach.}
\label{w111}
\end{center}
\end{figure}
```

### wnioski
 nie ma jednoznacznie najmocniejszego testu, ale wszystkie mają się dobrze
 
 
## zadanie 2

```{=LATEX}
Rozważmy próbę $\left(X_1, \ldots, X_{100}\right)$ z rozkładu normalnego $\mathcal{N}(\mu_1, 2^2)$ oraz próbę $\left(Y_1, \ldots, Y_{200}\right)$ z rozkładu normalnego $\mathcal{N}(\mu_2, 4^2)$. Wykonaj wykres funcji mocy na przedziale zawierającym przynajmniej po jednym punkcie z hipotezy zerowej i alternatywnej. Jak zmieniła się funkcja mocy testów?
```

### założenia  i cel zadania

### rozwiązanie 

```{r}
zad2 <- function(d, s1=2, s2=4, a = 0.05) {
    X <- rnorm(100, 0, s1)
    Y <- rnorm(200, d, s2)
    welch <- t.test(X, Y, alternative = "two.sided", var.equal = FALSE)$p.value < a
    ttest <- t.test(X, Y, alternative = "two.sided", var.equal = TRUE)$p.value < a
    wilcox <- wilcox.test(X, Y, alternative = "two.sided")$p.value < a
    c(ttest, welch, wilcox)
}

#v <-  sapply(d, zad2)
#for (i in seq(1,N-1,1)) {
#    v <- v + sapply(d, zad2)
#}
#mat <- v/N
```

```{r, include = FALSE}
#p <- ggplot() + geom_point(aes(d, mat[1,], color="t")) +
#geom_point(aes(d, mat[2,], color="t-welch")) + geom_point(aes(d, mat[3,], color="wilcoxon")) + 
#geom_line(aes(d, mat[1,], color="t")) +geom_line(aes(d, mat[2,], color="t-welch")) +
#geom_line(aes(d, mat[3,], color="wilcoxon"))+geom_line(aes(d, rep(0.05, length(d)), color="alpha = 0.05")) + labs(x="d", y ="moc") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))

#ggsave("2.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{2.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o różnych wariancjach.}
\label{w2}
\end{center}
\end{figure}
```

### wnioski
teraz najlepiej wypadł welch, bo t zakłada równość wariancji (temu odpiernicza) a wilcoxon jakoś się trzyma, ale nie jest tak dobry 

## zadanie 3

```{=LATEX}
Rozważmy próbę $\left(X_1, \ldots, X_{100}\right)$ z rozkładu wykładniczego $\mathcal{E}\left(\frac{1}{\mu_1}\right)$ oraz próbę $\left(Y_1, \ldots, Y_{200}\right)$ z rozkładu wykładniczego $\mathcal{E}\left(\frac{1}{\mu_2}\right)$. Wykonaj wykres funcji mocy na przedziale zawierającym przynajmniej po jednym punkcie z hipotezy zerowej i alternatywnej. Jak zmieniła się funkcja mocy testów?
```

### założenia  i cel zadania

### rozwiązanie 

```{r}
zad3 <- function(d, a = 0.05) {
    X <- rexp(100, 1/2)
    Y <- rexp(200, 1/(2 + d))
    welch <- t.test(X, Y, alternative = "two.sided", var.equal = FALSE)$p.value < a
    ttest <- t.test(X, Y, alternative = "two.sided", var.equal = TRUE)$p.value < a
    wilcox <- wilcox.test(X, Y, alternative = "two.sided")$p.value < a
    c(ttest, welch, wilcox)
}

#d <- seq(-1.9,1.9, 0.1)

#v3 <-  sapply(d, zad3)

#for (i in seq(1,N-1,1)) {
#    v3 <- v3 + sapply(d, zad3)
#}
#mat3 <- v3/N
```

```{r, include = FALSE}
#p <- ggplot() + geom_point(aes(d, mat3[1,], color="t")) +
#geom_point(aes(d, mat3[2,], color="t-welch")) + geom_point(aes(d, mat3[3,], color="wilcoxon")) + 
#geom_line(aes(d, mat3[1,], color="t")) + geom_line(aes(d, mat3[2,], color="t-welch")) +
#geom_line(aes(d, mat3[3,], color="wilcoxon")) + geom_line(aes(d, rep(0.05, length(d)), color="alpha = 0.05")) + labs(x="d", y ="moc") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))

#ggsave("3.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{3.jpg}
\caption{Moce testów dla prób z rozkładu wykładniczego.}
\label{w3}
\end{center}
\end{figure}
```
```{r, include = FALSE}
#p <- ggplot() + geom_line(aes(d, (mat3[1,]-mat3[2,]), color="t-welch")) +
#geom_line(aes(d, (mat3[2,] - mat3[3,]), color="welch -wc")) + geom_line(aes(d, (mat3[1,] - mat3[3,]), color="t-wc"))+ labs(x="d", y ="dpower") +
#theme(plot.title = element_text(hjust = 0.5)) + guides(color = guide_legend(title = "test"))
#ggsave("311.jpg", p)
```

```{=Latex}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{311.jpg}
\caption{Moce testów dla prób z rozkładu normalnego o równych wariancjach.}
\label{w311}
\end{center}
\end{figure}
```
### wnioski

pojęcia nie mam co tu napisać, to tak odpiernicza, ale teoretycznie najlepiej powinien wypaść wilcoxon (bo nie zakłada rozkładu normalnego)

ale problem moze byc z dwustronnością hipotezy (kwestia przesunięcia)

# Podsumowanie
